@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Search";
}

<div class="search-page text-center">
    <h1>Search Music</h1>
    <form id="searchForm" class="mb-4">
        <input type="text" id="searchQuery" placeholder="Search for songs..." class="form-control" />
        <button type="submit" class="btn btn-primary mt-2">Search</button>
    </form>

    <div id="searchResults" class="result-list"></div>
</div>

<script>
    document.getElementById('searchForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const query = document.getElementById('searchQuery').value.trim();
        const resultsContainer = document.getElementById('searchResults');
        resultsContainer.innerHTML = `<p>Searching...</p>`;

        if (!query) {
            resultsContainer.innerHTML = `<p>Please enter a search query.</p>`;
            return;
        }

        try {
            const results = await spotifyService.searchTracks(query);
            if (results.length === 0) {
                resultsContainer.innerHTML = `<p>No tracks found.</p>`;
                return;
            }
            resultsContainer.innerHTML = results.map(track => `
    <div class="result-item d-flex align-items-center mb-3">
        <img src="${track.album.images[0]?.url || '/images/default-album.jpg'}" alt="Album Cover" class="album-cover me-3" />
        <div class="track-info text-start">
            <h5 class="mb-1">${track.name}</h5>
            <p class="mb-1">${track.artists.map(artist => artist.name).join(", ")}</p>
            <p class="mb-1">${(track.durationMs / 60000).toFixed(2)} mins</p>
        </div>
        <div class="actions ms-auto">
            <a href="${track.externalUrls.spotify}" target="_blank" class="btn btn-primary">Open in Spotify</a>
        </div>
    </div>
`).join('');

        } catch (error) {
            console.error(error);
            resultsContainer.innerHTML = `<p>Error: Unable to fetch results</p>`;
        }
    });
</script>

<style>
    .search-page {
        padding: 40px;
    }

    .result-list {
        margin-top: 20px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .result-item {
        display: flex;
        align-items: center;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
    }

    .result-item:not(:last-child) {
        margin-bottom: 15px;
    }

    .album-cover {
        width: 60px;
        height: 60px;
        border-radius: 5px;
        object-fit: cover;
    }

    .track-info h5 {
        font-size: 16px;
        margin: 0;
    }

    .track-info p {
        font-size: 14px;
        margin: 0;
    }

    .actions .audio-player {
        width: 150px;
    }
</style>
